<Page
    x:Class="DrawingApp.UI.Pages.DrawingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:enums="using:DrawingApp.Core.Enums"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:conv="using:DrawingApp.UI.Converters"
    xmlns:models="using:DrawingApp.UI.Models">

    <Page.Resources>
        <conv:HexToBrushConverter x:Key="HexToBrush"/>
    </Page.Resources>

    <Grid RowDefinitions="Auto,*" Padding="12">

        <!-- Toolbar -->
        <Border
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
            BorderThickness="1"
            CornerRadius="10"
            Padding="12">

            <toolkit:WrapPanel Orientation="Horizontal"
                               HorizontalSpacing="14"
                               VerticalSpacing="10">

                <!-- Back -->
                <Button Command="{Binding BackCommand}" VerticalAlignment="Bottom">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE72B;"/>
                        <TextBlock Text="Back"/>
                    </StackPanel>
                </Button>

                <!-- Board Name -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Board name" Opacity="0.7" FontSize="12"/>
                    <TextBox Width="180"
                             PlaceholderText="Untitled Board"
                             Text="{Binding BoardName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Tool -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Tool" Opacity="0.7" FontSize="12"/>
                    <ComboBox Width="170"
                              ItemsSource="{Binding ToolOptions}"
                              SelectedItem="{Binding CurrentTool, Mode=TwoWay}"/>
                </StackPanel>

                <!-- ===== Paint-like Colors (Single Color) ===== -->
                <StackPanel Spacing="6">
                    <TextBlock Text="Colors" Opacity="0.7" FontSize="12"/>

                    <!-- Selected color preview + More colors -->
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <Border Width="26" Height="26" CornerRadius="4"
                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1"
                Background="{Binding SelectedColor, Converter={StaticResource HexToBrush}}"/>

                        <TextBlock Text="{Binding SelectedColor}" Opacity="0.7" VerticalAlignment="Center"/>

                        <Button Content="More..." Click="MoreColors_Click"/>
                    </StackPanel>

                    <!-- Basic palette -->
                    <ItemsControl ItemsSource="{Binding BasicColors}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <toolkit:WrapPanel Orientation="Horizontal"
                                   HorizontalSpacing="6"
                                   VerticalSpacing="6"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Width="22" Height="22"
                                        CornerRadius="4"
                                        Tag="{Binding Hex}"
                                        ToolTipService.ToolTip="{Binding Name}"
                                        Background="{Binding Hex, Converter={StaticResource HexToBrush}}"
                                        Click="ColorSwatch_Click"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>


                <!-- Thickness -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Thickness" Opacity="0.7" FontSize="12"/>
                    <NumberBox Width="110"
                               Minimum="1"
                               SmallChange="1"
                               Value="{Binding Thickness, Mode=TwoWay}"
                               ValueChanged="Thickness_ValueChanged"/>
                </StackPanel>

                <!-- Board Width -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Board width" Opacity="0.7" FontSize="12"/>
                    <NumberBox Width="120"
                               Minimum="100"
                               Value="{Binding BoardWidth, Mode=TwoWay}"
                               ValueChanged="BoardW_ValueChanged"/>
                </StackPanel>

                <!-- Board Height -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Board height" Opacity="0.7" FontSize="12"/>
                    <NumberBox Width="120"
                               Minimum="100"
                               Value="{Binding BoardHeight, Mode=TwoWay}"
                               ValueChanged="BoardH_ValueChanged"/>
                </StackPanel>

                <!-- Save -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Board" Opacity="0.0" FontSize="12"/>
                    <Button Content="Save Board"
                            Command="{Binding SaveBoardCommand}"/>
                </StackPanel>

                <!-- Fill Mode -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Fill mode" Opacity="0.7" FontSize="12"/>
                    <ToggleButton Content="Enable"
                                  IsChecked="{Binding IsFillMode, Mode=TwoWay}"/>
                </StackPanel>

                <!-- Selection -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Selection" Opacity="0.7" FontSize="12"/>
                    <ToggleButton Content="Enable"
                                  IsChecked="{Binding IsSelectionMode, Mode=TwoWay}"/>
                </StackPanel>

                <!-- Save selection -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Templates" Opacity="0.7" FontSize="12"/>
                    <Button Content="Save Selection"
                            Command="{Binding SaveSelectionCommand}"
                            IsEnabled="{Binding HasSelection}"/>
                </StackPanel>

                <StackPanel Spacing="4">
                    <TextBlock Text="Zoom" Opacity="0.7" FontSize="12"/>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Button Content="-" Click="ZoomOut_Click"/>
                        <Button Content="100%" Click="ZoomReset_Click"/>
                        <Button Content="+" Click="ZoomIn_Click"/>
                    </StackPanel>
                </StackPanel>
            </toolkit:WrapPanel>
        </Border>

        <!-- Canvas area -->
        <Border Grid.Row="1"
        Margin="0,12,0,0"
        Background="#FFF3F4F6"
        BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
        BorderThickness="1">

            <ScrollViewer x:Name="BoardScroll"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto"
                  ZoomMode="Enabled"
                  MinZoomFactor="0.25"
                  MaxZoomFactor="4.0">

                <Border x:Name="BoardSurface"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Width="{Binding BoardWidth}"
                Height="{Binding BoardHeight}"
                Background="{Binding BoardBackground, Converter={StaticResource HexToBrush}}"
                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1">

                    <Grid>
                        <Canvas x:Name="DrawCanvas"
                        Background="Transparent"
                        Width="{Binding BoardWidth}"
                        Height="{Binding BoardHeight}"
                        Tapped="DrawCanvas_Tapped"/>

                        <Canvas x:Name="SelectionOverlay"
                        Background="Transparent"
                        Width="{Binding BoardWidth}"
                        Height="{Binding BoardHeight}"
                        IsHitTestVisible="{Binding IsSelectionMode}"
                        PointerPressed="Selection_Pressed"
                        PointerMoved="Selection_Moved"
                        PointerReleased="Selection_Released"/>
                    </Grid>
                </Border>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>
