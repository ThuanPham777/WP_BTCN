<Page
    x:Class="DrawingApp.UI.Pages.DrawingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:enums="using:DrawingApp.Core.Enums">

    <Grid RowDefinitions="Auto,*" Padding="12">

        <!-- Toolbar -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled">
            <StackPanel Orientation="Horizontal" Spacing="8">

                <TextBox Width="160"
                         PlaceholderText="Name"
                         Text="{Binding BoardName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <ComboBox Width="180"
                          ItemsSource="{Binding ToolOptions}"
                          SelectedItem="{Binding CurrentTool, Mode=TwoWay}"/>

                <TextBox Width="140"
                         PlaceholderText="Stroke #AARRGGBB"
                         Text="{Binding StrokeColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBox Width="140"
                         PlaceholderText="Fill #AARRGGBB"
                         Text="{Binding FillColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <NumberBox Width="110"
                           Header="Thickness"
                           Value="{Binding Thickness, Mode=TwoWay}"/>

                <!-- Nếu bạn từng bị case NumberBox không update UI,
                     giữ ValueChanged để chắc chắn -->
                <NumberBox Width="120"
                           Header="Board W"
                           Value="{Binding BoardWidth, Mode=TwoWay}"
                           ValueChanged="BoardW_ValueChanged"/>

                <NumberBox Width="120"
                           Header="Board H"
                           Value="{Binding BoardHeight, Mode=TwoWay}"
                           ValueChanged="BoardH_ValueChanged"/>

                <TextBox Width="160"
                         PlaceholderText="Board BG"
                         Text="{Binding BoardBackground, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <Button Content="Save Board"
                        Command="{Binding SaveBoardCommand}"/>

                <!-- Fill -->
                <ToggleButton Content="Fill Mode"
                              IsChecked="{Binding IsFillMode, Mode=TwoWay}"/>

                <!-- Selection -->
                <ToggleButton Content="Selection"
                              IsChecked="{Binding IsSelectionMode, Mode=TwoWay}"/>

                <!-- Save selection to templates -->
                <Button Content="Save Selection -> Templates"
                        Command="{Binding SaveSelectionCommand}"
                        IsEnabled="{Binding HasSelection}"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Canvas area -->
        <Border Grid.Row="1"
                Margin="0,12,0,0"
                Background="White"
                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1">

            <!-- Layered canvas -->
            <Grid>
                <!-- Draw layer -->
                <Canvas x:Name="DrawCanvas"
                        Background="Transparent"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Width="{Binding BoardWidth}"
                        Height="{Binding BoardHeight}"/>

                <!-- Selection overlay -->
                <Canvas x:Name="SelectionOverlay"
                        Background="Transparent"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Width="{Binding BoardWidth}"
                        Height="{Binding BoardHeight}"
                        IsHitTestVisible="{Binding IsSelectionMode}"
                        PointerPressed="Selection_Pressed"
                        PointerMoved="Selection_Moved"
                        PointerReleased="Selection_Released"/>
            </Grid>
        </Border>
    </Grid>
</Page>
